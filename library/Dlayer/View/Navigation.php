<?php
/**
* Simple navigation menu, nav tag wrapped around a tags, selected item 
* is given an active class.
* 
* @author Dean Blackborough <dean@g3d-development.com>
* @copyright G3D Development Limited
* @version $Id: Navigation.php 1568 2014-02-14 14:59:50Z Dean.Blackborough $
*/
class Dlayer_View_Navigation extends Zend_View_Helper_Abstract 
{
    /**
    * Override the hinting for the view property so that we can see the view
    * helpers that have been defined
    *
    * @var Dlayer_View_Codehinting
    */
    public $view;
    
    private $class;
    private $items;
    private $active_url;
    
    /**
    * Simple navigation menu, nav tag wrapped around a tags, selected item 
    * is given an active class.
    * 
    * @param string $class Class for menu container
    * @param array $items Array of menu links, each item should be an array 
    *                     with url and name fields for the data
    * @param string $active_url The active URL, used to assign the selected 
    *                           class
    * @return Dlayer_View_Navigation
    */
    public function navigation($class, array $items, $active_url='') 
    {
        $this->resetParams();
        
        $this->class = $class;
        $this->items = $items;
        $this->active_url = $active_url;
        
        return $this;
    }
    
    /**
    * Reset any internal params, need to reset the params in case the view 
    * helper is called multiple times within the same view.
    * 
    * @return void
    */
    public function resetParams() 
    {
        $this->class = '';
        $this->items = array();
        $this->active_url = '';
    }
    
    /**
    * Generate the html
    * 
    * @return string 
    */
    private function render() 
    {
        $html = '';
        
        if(count($this->items) > 0) {
            
            $html = '<div class="' . $this->class . '">';
            
            foreach($this->items as $item) {
                $html .= '<a  href="' . $this->view->escape($item['url']) . '"';
                
                if($item['url'] == $this->active_url) { 
                    $html .= ' class="selected"';
                }
                
                $html .= '>' . $this->view->escape($item['name']) . '</a>';
            }
            
            $html .= '</div>';
        }
        
        return $html;
    }
    
    /**
    * The view helpers can be output directly, no need to call and return the 
    * render method, we define the __toString method so that echo and print 
    * calls on the object return the html generated by the render method
    * 
    * @return string Generated html
    */
    public function __toString() 
    {
        return $this->render();
    }
    
}
